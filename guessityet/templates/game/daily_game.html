<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>GuessItYet - Juego Diario</title>

    <!-- Bootstrap CSS -->
    {% load bootstrap5 %}
    {% bootstrap_css %}

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/daily_game.css' %}">
</head>
<body class="bg-light">
{% csrf_token %}

<div class="container-fluid">
    <div class="game-container">

        <!-- Header del juego -->
        <div class="game-header">
            <div class="igdb-badge">
                <i class="fas fa-database me-1"></i>IGDB
            </div>

            <h1 class="mb-2">
                <i class="fas fa-gamepad me-2"></i>Juego #1
            </h1>
            <p class="mb-0">{{ today|date:"j F Y" }}</p>

            <!-- Información de franquicia si está disponible -->
            {% if game.franchise_name %}
                <div class="franchise-info">
                    <i class="fas fa-crown me-2"></i>
                    <strong>Franquicia:</strong> {{ game.franchise_name }}
                </div>
            {% endif %}

            <!-- Botón de prueba (solo en desarrollo) -->
            <div class="mt-3">
                <button onclick="generateNewTestGame()" class="btn btn-light btn-sm">
                    <i class="fas fa-refresh me-1"></i>Nuevo Juego IGDB
                </button>
            </div>
        </div>

        <!-- Contenedor de la imagen principal -->
        <div class="screenshot-container">
            {% if screenshots %}
                <img id="current-screenshot"
                     src="{% if screenshots.0.local_path %}/media/{{ screenshots.0.local_path }}{% else %}{{ screenshots.0.image_url }}{% endif %}"
                     alt="Screenshot del juego"
                     class="screenshot-main">

                <!-- Información superpuesta -->
                <div class="game-info-overlay" id="game-info-overlay" style="display: none;">
                    <div id="info-content">
                        <!-- La información se mostrará según la imagen -->
                    </div>
                </div>

                <!-- Indicador de tipo de contenido -->
                <div class="video-type-indicator" id="content-type-indicator" style="display: none;">
                    <i class="fas fa-film me-1"></i>Vídeo
                </div>

                <!-- Overlay para zoom -->
                <div class="zoom-overlay" id="zoom-overlay"></div>
            {% else %}
                <div class="alert alert-warning">
                    No hay capturas disponibles para este juego.
                </div>
            {% endif %}
        </div>

        <!-- Indicador de intentos clicables -->
        <div class="attempts-indicator">
            {% for i in "123456" %}
                <div class="attempt-circle" id="attempt-{{ i }}" data-attempt="{{ i }}" onclick="navigateToAttempt({{ i }})">
                    {{ i }}
                </div>
            {% endfor %}
        </div>

        <!-- Mensaje de intentos restantes / resultado del juego -->
        <div class="remaining-attempts" id="remaining-attempts">
            {% if game_state.won %}
                {% if game_state.guessed_it %}
                    <div class="alert alert-success text-center mb-0">
                        <h4><i class="fas fa-star me-2"></i>¡GUESSED IT!</h4>
                        <p class="mb-0">¡Acertaste en el primer intento!</p>
                    </div>
                {% else %}
                    <div class="alert alert-success text-center mb-0">
                        <h4><i class="fas fa-trophy me-2"></i>¡Ganaste!</h4>
                        <p class="mb-0">La respuesta correcta era: <strong>{{ game.title }}</strong></p>
                    </div>
                {% endif %}
            {% elif game_state.lost %}
                <div class="alert alert-danger text-center mb-0">
                    <h4><i class="fas fa-skull me-2"></i>¡Perdiste!</h4>
                    <p class="mb-0">La respuesta correcta era: <strong>{{ game.title }}</strong></p>
                </div>
            {% else %}
                ¡Te quedan 6 intentos!
            {% endif %}
        </div>

        <!-- Área de juego principal -->
        <div id="game-area">
            {% if not game_state.won and not game_state.lost %}

                <!-- Barra de búsqueda -->
                <div class="search-container">
                    <div class="input-group">
                        <input type="text"
                               class="form-control search-input"
                               id="game-search"
                               placeholder="Escribe el nombre del juego..."
                               autocomplete="off">
                        <button class="btn btn-secondary btn-skip"
                                type="button"
                                id="skip-btn">
                            <i class="fas fa-forward me-1"></i>Saltar
                        </button>
                    </div>

                    <!-- Sugerencias de búsqueda -->
                    <div class="search-suggestions" id="search-suggestions">
                        <!-- Se llenarán dinámicamente -->
                    </div>
                </div>

                <!-- Botón de envío -->
                <div class="text-center mb-3">
                    <button class="btn btn-primary btn-lg"
                            id="submit-btn"
                            disabled>
                        <i class="fas fa-paper-plane me-2"></i>Enviar Respuesta
                    </button>
                </div>

            {% endif %}

            <!-- Mensaje de victoria/derrota -->
            {% if game_state.won %}
                <div class="alert alert-success text-center">
                    <p class="mb-0">La respuesta correcta era: <strong>{{ game.title }}</strong></p>
                    {% if game.franchise_name %}
                        <p class="mb-0"><i class="fas fa-crown me-1"></i>Franquicia: <strong>{{ game.franchise_name }}</strong></p>
                    {% endif %}
                </div>
            {% elif game_state.lost %}
                <div class="alert alert-danger text-center">
                    <p class="mb-0">¡Más suerte la próxima vez!</p>
                    {% if game.franchise_name %}
                        <p class="mb-0"><i class="fas fa-crown me-1"></i>Franquicia: <strong>{{ game.franchise_name }}</strong></p>
                    {% endif %}
                </div>
            {% endif %}
        </div>

        <!-- Historial de intentos -->
        <div class="attempts-history" id="attempts-history" style="display: none;">
            <h5><i class="fas fa-list me-2"></i>Historial de Intentos</h5>
            <div id="attempts-history-content">
                <!-- Se llenará dinámicamente -->
            </div>
        </div>

        <!-- Botones finales -->
        {% if game_state.won or game_state.lost %}
        <div class="game-ended">
            <div class="d-flex justify-content-center gap-3">
                <button class="btn btn-outline-secondary" onclick="showOtherDays()">
                    <i class="fas fa-calendar me-2"></i>Ir a días anteriores
                </button>
            </div>
        </div>
        {% endif %}

        <!-- Timer countdown -->
        <div class="countdown-timer">
            <i class="fas fa-clock me-2"></i>
            <span id="countdown-display">Calculando...</span>
        </div>

    </div>
</div>

<!-- Bootstrap JavaScript -->
{% bootstrap_javascript %}

<!-- Variables globales del juego -->
<script>
    // Datos del juego pasados desde Django
    const gameState = {{ game_state_json|safe }};
    const gameData = {
        id: {{ game.id }},
        title: "{{ game.title|escapejs }}",
        developer: "{{ game.developer|default:''|escapejs }}",
        release_year: {{ game.release_year|default:'null' }},
        genres: "{{ game.genres|default:''|escapejs }}",
        platforms: "{{ game.platforms|default:''|escapejs }}",
        metacritic: {{ game.metacritic|default:'null' }},
        franchise_name: "{{ game.franchise_name|default:''|escapejs }}",
        franchise_slug: "{{ game.franchise_slug|default:''|escapejs }}",
        gif_path: "{{ game.gif_path|default:''|escapejs }}",
        video_url: "{{ game.video_url|default:''|escapejs }}",
        igdb_id: {{ game.igdb_id|default:'null' }},
        rawg_id: {{ game.rawg_id|default:'null' }}
    };
    const screenshots = [
        {% for screenshot in screenshots %}
        {
            difficulty: {{ screenshot.difficulty }},
            url: "{% if screenshot.local_path %}/media/{{ screenshot.local_path }}{% else %}{{ screenshot.image_url }}{% endif %}"
        }{% if not forloop.last %},{% endif %}
        {% endfor %}
    ];
</script>

<!-- Custom JavaScript -->
<script src="{% static 'js/daily_game.js' %}"></script>

</body>
</html>